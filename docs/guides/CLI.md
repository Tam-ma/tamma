# Tamma CLI Guide

Quick-start guide for the `tamma` command-line interface.

## Prerequisites

- **Node.js** 20+
- **pnpm** 9+
- **Git** 2.40+
- **Claude Code CLI** installed and authenticated (`claude --version`)
- A **GitHub** personal access token with `repo` scope
- An **Anthropic API key**

## Getting Started

### 1. Initialize a project

```bash
tamma init
```

The init wizard runs four phases:

1. **Pre-flight checks** — verifies Node, Git, and Claude CLI are available
2. **Configuration wizard** — collects credentials and project settings:
   - GitHub token (masked input, or press Enter to use `GITHUB_TOKEN` env var)
   - Anthropic API key (masked input, or press Enter to use `ANTHROPIC_API_KEY` env var)
   - GitHub owner and repository (auto-detected from git remote)
   - Issue labels, AI model, budget, working directory, approval mode
3. **Post-config checks** — tests GitHub API access, validates Claude CLI, creates `tamma` label, updates `.gitignore`
4. **Done** — prints next steps

The wizard produces two files:

| File | Contents | Permissions |
|------|----------|-------------|
| `tamma.config.json` | Project settings (no secrets) | Default |
| `.env` | `GITHUB_TOKEN` and `ANTHROPIC_API_KEY` | `0600` (owner-only) |

Both `.env` and `.tamma/` are added to `.gitignore` automatically.

If a `.env` file already exists, the wizard merges credentials into it — existing variables are preserved.

### 2. Start the engine

```bash
tamma start
```

The engine loads configuration in layers (later layers override earlier ones):

```
defaults → tamma.config.json → .env / environment variables → CLI flags
```

It then polls for GitHub issues matching your configured labels and processes them through the pipeline:

```
Select issue → Analyze context → Generate plan → Approval → Implement → Create PR → Monitor CI → Merge
```

## Commands

### `tamma init`

Interactive setup wizard. Will not overwrite an existing `tamma.config.json` — delete it first to re-run.

### `tamma start [options]`

Start the engine.

| Flag | Description | Default |
|------|-------------|---------|
| `--config <path>` | Path to config file | `./tamma.config.json` |
| `--dry-run` | Select, analyze, plan, then exit (no implementation) | off |
| `--once` | Process one issue then exit | off |
| `--approval <mode>` | `cli` (manual) or `auto` (approve all plans) | `cli` |
| `-i, --interactive` | Interactively select which issue to process | off |
| `--verbose` | Enable debug logging | off |
| `--debug` | Debug logging + write logs to file | off |

### `tamma status`

Show current engine state.

## Configuration

### `tamma.config.json`

Generated by `tamma init`. Key sections:

```jsonc
{
  "mode": "standalone",
  "logLevel": "info",
  "github": {
    "token": "",           // loaded from .env, not stored here
    "owner": "your-org",
    "repo": "your-repo",
    "issueLabels": ["tamma"],
    "excludeLabels": ["wontfix"],
    "botUsername": "tamma-bot"
  },
  "agent": {
    "model": "claude-sonnet-4-5",
    "maxBudgetUsd": 1.0,
    "allowedTools": ["Read", "Write", "Edit", "Bash", "Glob", "Grep"],
    "permissionMode": "default"
  },
  "engine": {
    "pollIntervalMs": 300000,
    "workingDirectory": ".",
    "maxRetries": 3,
    "approvalMode": "cli",
    "ciPollIntervalMs": 30000,
    "ciMonitorTimeoutMs": 3600000
  }
}
```

### `.env`

Credentials file written by `tamma init` with restricted permissions (`0600`):

```bash
# Tamma credentials — DO NOT COMMIT
GITHUB_TOKEN=ghp_...
ANTHROPIC_API_KEY=sk-ant-...
```

Loaded automatically at startup via `dotenv`. If you skip a credential during init, it is written as a commented placeholder:

```bash
# GITHUB_TOKEN=ghp_your_token_here
```

### Environment Variables

All settings can be overridden via environment variables:

| Variable | Overrides |
|----------|-----------|
| `GITHUB_TOKEN` / `TAMMA_GITHUB_TOKEN` | `github.token` |
| `TAMMA_GITHUB_OWNER` | `github.owner` |
| `TAMMA_GITHUB_REPO` | `github.repo` |
| `TAMMA_BOT_USERNAME` | `github.botUsername` |
| `TAMMA_ISSUE_LABELS` | `github.issueLabels` (comma-separated) |
| `TAMMA_EXCLUDE_LABELS` | `github.excludeLabels` (comma-separated) |
| `TAMMA_MODEL` | `agent.model` |
| `TAMMA_MAX_BUDGET_USD` | `agent.maxBudgetUsd` |
| `TAMMA_PERMISSION_MODE` | `agent.permissionMode` |
| `TAMMA_POLL_INTERVAL_MS` | `engine.pollIntervalMs` |
| `TAMMA_WORKING_DIRECTORY` | `engine.workingDirectory` |
| `TAMMA_APPROVAL_MODE` | `engine.approvalMode` |
| `TAMMA_LOG_LEVEL` | `logLevel` |

## Typical Workflow

```bash
# First time setup
tamma init

# Process all labeled issues continuously
tamma start

# Process one issue then stop
tamma start --once

# Preview what the engine would do without implementing
tamma start --dry-run

# Pick which issue to work on
tamma start --interactive --once

# Auto-approve all plans (no manual review)
tamma start --approval auto
```
